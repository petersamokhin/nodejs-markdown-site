!function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../../addon/mode/overlay")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed","../../addon/mode/overlay"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";CodeMirror.defineMode("django:inner",function(){var keywords=["block","endblock","for","endfor","true","false","filter","endfilter","loop","none","self","super","if","elif","endif","as","else","import","with","endwith","without","context","ifequal","endifequal","ifnotequal","endifnotequal","extends","include","load","comment","endcomment","empty","url","static","trans","blocktrans","endblocktrans","now","regroup","lorem","ifchanged","endifchanged","firstof","debug","cycle","csrf_token","autoescape","endautoescape","spaceless","endspaceless","ssi","templatetag","verbatim","endverbatim","widthratio"],filters=["add","addslashes","capfirst","center","cut","date","default","default_if_none","dictsort","dictsortreversed","divisibleby","escape","escapejs","filesizeformat","first","floatformat","force_escape","get_digit","iriencode","join","last","length","length_is","linebreaks","linebreaksbr","linenumbers","ljust","lower","make_list","phone2numeric","pluralize","pprint","random","removetags","rjust","safe","safeseq","slice","slugify","stringformat","striptags","time","timesince","timeuntil","title","truncatechars","truncatechars_html","truncatewords","truncatewords_html","unordered_list","upper","urlencode","urlize","urlizetrunc","wordcount","wordwrap","yesno"],operators=["==","!=","<",">","<=",">="],wordOperators=["in","not","or","and"];function tokenBase(stream,state){if(stream.match("{{"))return state.tokenize=inVariable,"tag";if(stream.match("{%"))return state.tokenize=inTag,"tag";if(stream.match("{#"))return state.tokenize=inComment,"comment";for(;null!=stream.next()&&!stream.match(/\{[{%#]/,!1););return null}function inString(delimiter,previousTokenizer){return function(stream,state){!state.escapeNext&&stream.eat(delimiter)?state.tokenize=previousTokenizer:(state.escapeNext&&(state.escapeNext=!1),"\\"==stream.next()&&(state.escapeNext=!0));return"string"}}function inVariable(stream,state){if(state.waitDot){if(state.waitDot=!1,"."!=stream.peek())return"null";if(stream.match(/\.\W+/))return"error";if(stream.eat("."))return state.waitProperty=!0,"null";throw Error("Unexpected error while waiting for property.")}if(state.waitPipe){if(state.waitPipe=!1,"|"!=stream.peek())return"null";if(stream.match(/\.\W+/))return"error";if(stream.eat("|"))return state.waitFilter=!0,"null";throw Error("Unexpected error while waiting for filter.")}return state.waitProperty&&(state.waitProperty=!1,stream.match(/\b(\w+)\b/))?(state.waitDot=!0,state.waitPipe=!0,"property"):state.waitFilter&&(state.waitFilter=!1,stream.match(filters))?"variable-2":stream.eatSpace()?(state.waitProperty=!1,"null"):stream.match(/\b\d+(\.\d+)?\b/)?"number":stream.match("'")?(state.tokenize=inString("'",state.tokenize),"string"):stream.match('"')?(state.tokenize=inString('"',state.tokenize),"string"):stream.match(/\b(\w+)\b/)&&!state.foundVariable?(state.waitDot=!0,state.waitPipe=!0,"variable"):stream.match("}}")?(state.waitProperty=null,state.waitFilter=null,state.waitDot=null,state.waitPipe=null,state.tokenize=tokenBase,"tag"):(stream.next(),"null")}function inTag(stream,state){if(state.waitDot){if(state.waitDot=!1,"."!=stream.peek())return"null";if(stream.match(/\.\W+/))return"error";if(stream.eat("."))return state.waitProperty=!0,"null";throw Error("Unexpected error while waiting for property.")}if(state.waitPipe){if(state.waitPipe=!1,"|"!=stream.peek())return"null";if(stream.match(/\.\W+/))return"error";if(stream.eat("|"))return state.waitFilter=!0,"null";throw Error("Unexpected error while waiting for filter.")}if(state.waitProperty&&(state.waitProperty=!1,stream.match(/\b(\w+)\b/)))return state.waitDot=!0,state.waitPipe=!0,"property";if(state.waitFilter&&(state.waitFilter=!1,stream.match(filters)))return"variable-2";if(stream.eatSpace())return state.waitProperty=!1,"null";if(stream.match(/\b\d+(\.\d+)?\b/))return"number";if(stream.match("'"))return state.tokenize=inString("'",state.tokenize),"string";if(stream.match('"'))return state.tokenize=inString('"',state.tokenize),"string";if(stream.match(operators))return"operator";if(stream.match(wordOperators))return"keyword";var keywordMatch=stream.match(keywords);return keywordMatch?("comment"==keywordMatch[0]&&(state.blockCommentTag=!0),"keyword"):stream.match(/\b(\w+)\b/)?(state.waitDot=!0,state.waitPipe=!0,"variable"):stream.match("%}")?(state.waitProperty=null,state.waitFilter=null,state.waitDot=null,state.waitPipe=null,state.blockCommentTag?(state.blockCommentTag=!1,state.tokenize=inBlockComment):state.tokenize=tokenBase,"tag"):(stream.next(),"null")}function inComment(stream,state){return stream.match(/^.*?#\}/)?state.tokenize=tokenBase:stream.skipToEnd(),"comment"}function inBlockComment(stream,state){return stream.match(/\{%\s*endcomment\s*%\}/,!1)?(state.tokenize=inTag,stream.match("{%"),"tag"):(stream.next(),"comment")}return keywords=new RegExp("^\\b("+keywords.join("|")+")\\b"),filters=new RegExp("^\\b("+filters.join("|")+")\\b"),operators=new RegExp("^\\b("+operators.join("|")+")\\b"),wordOperators=new RegExp("^\\b("+wordOperators.join("|")+")\\b"),{startState:function(){return{tokenize:tokenBase}},token:function(stream,state){return state.tokenize(stream,state)},blockCommentStart:"{% comment %}",blockCommentEnd:"{% endcomment %}"}}),CodeMirror.defineMode("django",function(config){var htmlBase=CodeMirror.getMode(config,"text/html"),djangoInner=CodeMirror.getMode(config,"django:inner");return CodeMirror.overlayMode(htmlBase,djangoInner)}),CodeMirror.defineMIME("text/x-django","django")});